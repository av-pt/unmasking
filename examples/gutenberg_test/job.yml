# Example Job configuration for parsing Gutenberg test corpus
# You can append % to the names of objects or lists to inherit
# from the default configuration.

---
job%:
  # Input corpus options
  input:
    # Corpus parser class
    parser:
      name: input.formats.AuthorPairParser
      parameters:
        # Corpus path relative to the application directory
        corpus_path: examples/gutenberg_test/corpus

    # Chunker for creating chunks from input texts
    chunker:
      # Option 1: split on sentences (long texts only, slower)
#      name: input.chunkers.SentenceChunker
#      parameters:
#        chunk_size: $chunk_size
#        language: "english"

      # Option 2: sample chunks randomly (long and short texts, much faster)
      name: input.chunkers.RandomWordTokenChunker
      parameters:
        chunk_size: 700
        num_chunks: 30

  exec%.strategy%:
    parameters%:
      # Adjust unmasking iterations
      iterations: 24

      # Update plot after each iteration
      buffer_curves: false

  # Specify outputs. Since we are overriding the settings for the
  # UnmaskingCurvePlotter, we can't inherit from the default config
  outputs:
    - name: output.formats.UnmaskingStatAccumulator
      events:
        - name: onPairGenerated
        - name: onUnmaskingFinished

    - name: output.formats.UnmaskingCurvePlotter
      rc_file: etc/plot_rc.yml
      parameters:
        # Show live plot
        display: false

        # Set fixed xlim values since we know how many curve points we'll be getting
        xlim: [0, 23]
      events:
        - name: onUnmaskingRoundFinished

    - name: output.formats.ProgressPrinter
      events:
        - name: onChunkingProgress
        - name: onPairGenerated

  experiment%:
    configurations:
      # Perform and aggregate two runs, one with a chunk size of
      # 500 and one with a chunk size of 600
      chunk_size: [500, 600]

    # Repeat each configuration three times
    repetitions: 2

    aggregators:
      # Aggregate curves by averaging them
      - name: output.aggregators.CurveAverageAggregator
        events:
          - name: onUnmaskingFinished
          - name: onPairGenerated

      # Visualize aggregated curves
      - name: output.aggregators.AggregatedCurvePlotter
        rc_file: plot_rc.yml
        parameters:
          display: false
        events:
          - name: onJobFinished
